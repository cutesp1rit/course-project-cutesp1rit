# ADR-001: Secure file uploads (magic bytes, size limits, UUID names)
Дата: 2025-10-19
Статус: Accepted

## Context
Нужно безопасно принимать изображения для карточек. Риски: подмена MIME, слишком большие тела, traversal/симлинки.

## Decision
- Проверка magic bytes (PNG/JPEG) и расширение по типу.
- Лимит размера тела (1 MB), отказ с 413.
- Имя файла — UUID, сохранение в доверенной директории, запрет симлинков.

## Alternatives
- Доверять `Content-Type` заголовку — минус: легко подделать.
- Использовать внешнюю CDN-загрузку — плюс безопасность, минус сложность/стоимость.

## Consequences
- Потребуются тесты на большие/битые файлы.
- Небольшая нагрузка на CPU при проверке сигнатур.

## Security impact
Снижает риск DoS по телу, обхода типов и записи вне директории.

## Rollout plan
Фича-флаг не требуется; включается по умолчанию. Папка хранения — `var/uploads`.

## Links
- NFR: NFR-02, NFR-03, NFR-07, NFR-08
- Threat Model: F1, F3, R3, R7
- Tests: `tests/test_upload.py`
